
%%
%% Use this file to plot the figures validating the Meiyu-Baiu rainfall in CESM2LE
%%
%% compare simulated and obs precipiation pattern  
clc;clear all;
mon = 6:7;  
clear t0;clear t;
var = 'PRECT';
period = [1981:2010];
dir=['...'];
for num=1:100;num
    file=[dir,var,'_EastAsia_90E180E_0N60N_19002100_',num2str(num),'.nc']; 
    t = squeeze(ncread(file,var));
    t = reshape(t(:,:,1:130*12),[73,64,12,130]);
    t = squeeze(mean(t(:,:,mon,:),3));
    t = t(:,:,period-1900+1,:); 
    Pr0(:,:,:,num)=t;
end;

close all;figure(1); 
set(gcf, 'position', [100 200 500 320]); 
handaxes1 = axes('Position', [0.15 0.1 0.79 0.9]);
set(gcf,'color','w');
fontsi = 12;
hold on;

    m_proj('Equidistant Cylindrical','lon',[105 175],'lat',[23 47]); 
    imread('.../colormap.png');  color=ans(10,:,:);  colorfinal=(squeeze(color));colorfinal=colorfinal(200:200:end,:);colorfinal=cat(1,ones(1,3)*255,colorfinal(5:8,:),rgb('dark green')*255);colormap(double(colorfinal)/255)   
    latcesm=ncread(file,'lat');loncesm=ncread(file,'lon');[LON,LAT]=meshgrid(loncesm,latcesm);
    Pr=mean(mean(Pr0,3),4)*1000*60*60*24; % convert m/s to mm/day
    m_contourf(LON',LAT',Pr,[0:0.5:20],'linestyle','none','lineco',rgb('dark pink')); hold on; 
    cx=[3 9];caxis(cx);c=colorbar('horizontal','position',[0.6 0.36 0.3 0.025]); 
    c.Label.VerticalAlignment='bottom'; c.XTick=[1:2:20]; c. TickLength=0.01; c.FontSize =fontsi;

% compare with GPCP data
file='.../GPCP_pr/precip.mon.mean.nc';p=ncread(file,'precip');
    p=reshape(p(:,:,1:12*43),[144 72 12 43]);
    p=squeeze(mean(p(:,:,mon,:),3));
    Pr=nanmean(p(:,:,[1981:2010]-1979+1),3); % convert to mm/day
    longpcp=ncread(file,'lon');latgpcp=ncread(file,'lat');[LON,LAT]=meshgrid(longpcp,latgpcp);
    [cs2,h2]=m_contour(LON',LAT',Pr,[5:2:20],'linestyle','-','lineco',rgb('golden'),'linewi',1); 
% compare with ERA5 data
file='/Volumes/Data2/data-ERA5/precipitation/monthly/pr_era5_197901-202012.nc';p=ncread(file,'tp');
    p=reshape(p,[360 181 12 504/12]);
    p=squeeze(mean(p(:,:,mon,:),3));
    Pr=nanmean(p(:,:,[1981:2010]-1979+1),3);Pr=Pr*1000; %% mm/day
    lonera=ncread(file,'longitude');latera=ncread(file,'latitude');[LON,LAT]=meshgrid(lonera,latera);
    [cs1,h1]=m_contour(LON',LAT',Pr,[5:2:20],'linestyle','-','lineco',rgb('bright pink'),'linewi',1);

m_grid('box','on','linewidth',0.5,'linest','none','color',[1 1 1]*0,'tickdir','in','xtick',[-0:10:360],'ytick',[-80:5:90],'fontsize',fontsi);%'YTickLabel'
m_coast('linewidth',0.5,'color',[1 1 1]* 0 );  
    rivers = shaperead('worldrivers', 'UseGeoCoords', true);  
    Yangtzelon=[111.812126406705,111.617491409822,111.506201483461,111.377369777222,111.324577964913,111.304329409756,111.127690456420,110.579842600508,110.090971083005,109.859832209738,109.463170581409,109.126008277736,108.774428204806,108.622755527179,108.412454704962,108.109784975061,107.767845629656,107.605584604302,107.277336794183,106.866828394550,106.659409896486,106.414168831486,105.979101833691,105.879254886543,105.335096266790,105.129180209058,104.867723652864,104.706928692368,104.364592534880,104.091212606074,103.966204641485,103.849767714248,103.691780436767,103.555561827381,103.519273484281,103.275319667000,102.999059476395,102.926643930504,102.936081263710,103.036200292578,103.026305037876,102.959646199442,102.776685596601,102.676813014934,102.519277948189,102.373186994147,102.053298961830,101.898068985969,101.860762451450,101.919829634165,101.882272692055,101.751128720409,101.691160834859,101.501818525004,101.303255278576,100.931333808346,100.731049812833,100.562232817490,100.430413795709,100.412743659151,100.456270683369,100.515513586111,100.575339813117,100.486560665925,100.372539238615,100.281581958429,100.072996645657,100.058825731678,99.8426770937218,99.6975946675545,99.5112103566063,99.4160753092215,99.3942455093605,99.2780537292445,99.1468132666509,99.0462572273536,99.0052196089284,98.8874723334740,98.6915840424053,98.7522978847366,98.8734135680564,98.8718854272409,98.5442015300226,98.2994734004280,97.7481050517092,97.5708435465878,97.2822873630522,97.1124452710207,96.3147755285777,95.9688609087148,95.7349684681276,95.2926674087438,94.9086266837214,94.7573923372252,94.6211734395713,94.3047857799314,93.8281849372111,93.4544006457852,92.9682758665929,92.7825410413103,92.5330173320002,92.1815993074306,91.8845270925069,91.7002271597796,91.2827901881376,90.9613301232510,90.7397351892746,90.6181366693018,90.5568859681901,NaN,121.383878533308,121.325457092976,121.144532209900,120.842735400716,120.698510249433,120.575516191191,120.358951867320,120.062712534585,119.852697254398,119.709005180783,119.527915100958,118.952742017552,118.778554856493,118.551400228519,118.414873769980,118.143194670435,118.045444645088,117.844349036082,117.511746986411,116.960712182633,116.322123392025,116.042517828822,115.844266361835,115.636166105440,115.393102511384,115.205696301207,114.910639521637,114.620141972894,114.520492695992,114.386284365809,114.200353337241,114.103538562582,114.143633524371,114.153774989689,114.116554377170,114.001639765668,113.557748485311,113.179750008439,113.069133792820,113.002671041423,113.010185229963,112.956883633249,112.915184585693,112.636388167519,112.527242971986,112.352141065017,112.264755875691,112.156759802604,111.986886007699,111.897160939943,111.812126406705,NaN];
    Yangtzelat=[30.3354829609347,30.3162378996852,30.2994363172800,30.3679251066827,30.5377024362833,30.7308299991966,30.8547411902248,30.9708267262762,30.9965484287298,30.9932398372326,30.9985315308513,30.9774340139899,30.9373434730190,30.9201881974127,30.7637404293904,30.3548047491705,29.9716307614179,29.8528571509581,29.7546809498848,29.7014574893788,29.6020058192944,29.3448531876994,29.0323887211137,28.9573566038784,28.7406200729983,28.7549421002832,28.8771505350936,28.8215891085751,28.5968947947536,28.6117711004343,28.6443849522760,28.6326996761558,28.4886648209192,28.2433501304205,27.9277561320013,27.6644129695344,27.4392701995127,27.3451042286746,27.0923694742233,26.7061799896363,26.4278063747580,26.3208866772620,26.2090329010010,26.2037959809258,26.3505151466786,26.3150725686764,26.0002671902567,25.9676933423725,26.1065066213752,26.3394308679985,26.4706005717387,26.5650265572968,26.5665238417525,26.5387055197895,26.4525094270186,26.2339258539554,26.2193890779663,26.2626853657006,26.3831684122694,26.6635989074616,27.0460482426394,27.3092160395689,27.6481435779346,27.8090481708519,27.8318795062661,27.7529054988919,27.2359392948189,27.0305677868185,26.8601512381793,27.2414537303841,27.5392665966446,27.9150634742437,28.1747202542787,28.4439302451752,28.6489391336526,29.0591738977128,29.7127815188842,30.4393889221217,31.1578700056566,31.2657844146158,31.3778876241458,31.4946720073974,32.0389897640086,32.3661286583779,32.6919003113350,32.8578610401901,33.2375732510136,33.4107779233207,33.9549229930287,34.1573671823583,34.3155556534077,34.4862497526074,34.6127316796277,34.7355063819930,34.7439617007357,34.6347190985812,34.3187792912637,34.2353915429522,34.1612732547774,34.1342588281008,34.2788452999238,34.2377128646488,34.1587756823123,34.1955221850123,34.2813494294680,34.2787035330242,34.2577633907659,34.2185318369584,34.2180241573277,NaN,31.5788930047085,31.6575490994222,31.7250481181793,31.9680459270501,32.0887950295242,32.1198678392547,32.0924283667840,31.9873452956444,31.9984602282878,32.2732076066296,32.2909798612861,32.2221069566712,32.2085066667753,32.0998645498680,31.9553230684040,31.5140483922883,31.3026591888784,31.0860374497524,30.8452188114545,30.4717607488557,29.9255920520252,29.7550730847683,29.7509565428970,29.7855655953100,29.8720884312854,29.9965690719145,30.3283041654826,30.6020806249717,30.6547431330578,30.6691861831226,30.5039712752600,30.3634741572904,30.1699036543417,30.0410426110999,29.9449384371876,29.8561807420781,29.6682968936427,29.4658752583944,29.4448517220644,29.4904318012738,29.7390573777251,29.8040381455931,29.8109609087411,29.7937632161256,29.8222166012548,30.0510078908893,30.2111517118257,30.3089610598378,30.3495752696255,30.3450035841119,30.3354829609347,NaN];
    m_plot(Yangtzelon,Yangtzelat,'color',rgb('cyan'),'linewidth',1);
    
lonrange = near1(lonera,110):near1(lonera,140); latrange = near1(latera,35):near1(latera,25);
    kuang=zeros(size(Pr));
    kuang(lonrange,latrange)=100;
m_contour(LON',LAT',kuang,[100:100:200],'linestyle','-','linewidth',1.2,'color','k');   hold on; 

legend ([h1 h2],'ERA5','GPCP','color','none','edgecolor','none','fontsize',fontsi);

%% compare simulated and obs STD pattern  
clc;clear all;
mon = 6:7;  
clear t0;clear t;
var = 'PRECT';
period = [1981:2010];
dir=['...'];
for num=1:100;num
    file=[dir,var,'_EastAsia_90E180E_0N60N_19002100_',num2str(num),'.nc']; 
    t = squeeze(ncread(file,var));
    t = reshape(t(:,:,1:130*12),[73,64,12,130]);
    t = squeeze(mean(t(:,:,mon,:),3));
    t = t(:,:,period-1900+1,:); 
    Pr0(:,:,:,num)=t;
end;

close all;figure(1); 
set(gcf, 'position', [100 200 500 320]); 
handaxes1 = axes('Position', [0.15 0.1 0.79 0.9]);
set(gcf,'color','w');
fontsi = 12;
hold on;

    m_proj('Equidistant Cylindrical','lon',[105 175],'lat',[23 47]);
    imread('.../colormap.png');  color=ans(10,:,:);  colorfinal=(squeeze(color));colorfinal=colorfinal(200:200:end,:);colorfinal=cat(1,ones(1,3)*255,colorfinal(5:8,:),rgb('dark green')*255);colormap(double(colorfinal)/255)   
    Pr=reshape(Pr0,[73,64,30*100]);
    clear temp; for i=1:73;for j=1:64;  
                temp(i,j)=std(squeeze(Pr(i,j,:)));
                end;end; Pr=temp*1000*60*60*24; %convert m/s to mm/day
    latcesm=ncread(file,'lat');loncesm=ncread(file,'lon');[LON,LAT]=meshgrid(loncesm,latcesm);
    m_contourf(LON',LAT',Pr,[0:0.2:10],'linestyle','none','lineco',rgb('dark pink')); 
    cx=[1 1+6*0.5];caxis(cx); 
    c=colorbar('horizontal','position',[0.6 0.36 0.3 0.025]); 
    c.Label.VerticalAlignment='bottom'; c.XTick=[1:1:5]; c. TickLength=0.01; c.FontSize =fontsi;

% compare with GPCP data
file='.../precip.mon.mean.nc';p=ncread(file,'precip');
    p=reshape(p(:,:,1:12*43),[144 72 12 43]);
    p=squeeze(mean(p(:,:,mon,:),3));
    p=p(:,:,[1981:2010]-1979+1);
    clear temp; for i=1:144;for j=1:72; 
                temp(i,j)=std(squeeze(p(i,j,:)));
                end;end; Pr=temp;
    longpcp=ncread(file,'lon');latgpcp=ncread(file,'lat');[LON,LAT]=meshgrid(longpcp,latgpcp);
    [cs2,h2]=m_contour(LON',LAT',Pr,[2:0.5:6],'linestyle','-','lineco',rgb('golden'),'linewi',1); hold on; 
% compare with ERA5 data
file='.../pr_era5_197901-202012.nc';p=ncread(file,'tp');
    p=reshape(p,[360 181 12 504/12]);
    p=squeeze(mean(p(:,:,mon,:),3));
    p=p(:,:,[1981:2010]-1979+1) *1000;
    clear temp; for i=1:360;for j=1:181;  
                temp(i,j)=std(squeeze(p(i,j,:)));
                end;end; Pr=temp;
    lonera=ncread(file,'longitude');latera=ncread(file,'latitude');[LON,LAT]=meshgrid(lonera,latera);
    [cs1,h1]=m_contour(LON',LAT',Pr,[2:0.5:6],'linestyle','-','lineco',rgb('bright pink'),'linewi',1); hold on; 

m_grid('box','on','linewidth',0.5,'linest','none','color',[1 1 1]*0,'tickdir','in','xtick',[-0:10:360],'ytick',[-80:5:90],'fontsize',fontsi);%'YTickLabel'
m_coast('linewidth',0.5,'color',[1 1 1]* 0 );  

    rivers = shaperead('worldrivers', 'UseGeoCoords', true);  
    Yangtzelon=[111.812126406705,111.617491409822,111.506201483461,111.377369777222,111.324577964913,111.304329409756,111.127690456420,110.579842600508,110.090971083005,109.859832209738,109.463170581409,109.126008277736,108.774428204806,108.622755527179,108.412454704962,108.109784975061,107.767845629656,107.605584604302,107.277336794183,106.866828394550,106.659409896486,106.414168831486,105.979101833691,105.879254886543,105.335096266790,105.129180209058,104.867723652864,104.706928692368,104.364592534880,104.091212606074,103.966204641485,103.849767714248,103.691780436767,103.555561827381,103.519273484281,103.275319667000,102.999059476395,102.926643930504,102.936081263710,103.036200292578,103.026305037876,102.959646199442,102.776685596601,102.676813014934,102.519277948189,102.373186994147,102.053298961830,101.898068985969,101.860762451450,101.919829634165,101.882272692055,101.751128720409,101.691160834859,101.501818525004,101.303255278576,100.931333808346,100.731049812833,100.562232817490,100.430413795709,100.412743659151,100.456270683369,100.515513586111,100.575339813117,100.486560665925,100.372539238615,100.281581958429,100.072996645657,100.058825731678,99.8426770937218,99.6975946675545,99.5112103566063,99.4160753092215,99.3942455093605,99.2780537292445,99.1468132666509,99.0462572273536,99.0052196089284,98.8874723334740,98.6915840424053,98.7522978847366,98.8734135680564,98.8718854272409,98.5442015300226,98.2994734004280,97.7481050517092,97.5708435465878,97.2822873630522,97.1124452710207,96.3147755285777,95.9688609087148,95.7349684681276,95.2926674087438,94.9086266837214,94.7573923372252,94.6211734395713,94.3047857799314,93.8281849372111,93.4544006457852,92.9682758665929,92.7825410413103,92.5330173320002,92.1815993074306,91.8845270925069,91.7002271597796,91.2827901881376,90.9613301232510,90.7397351892746,90.6181366693018,90.5568859681901,NaN,121.383878533308,121.325457092976,121.144532209900,120.842735400716,120.698510249433,120.575516191191,120.358951867320,120.062712534585,119.852697254398,119.709005180783,119.527915100958,118.952742017552,118.778554856493,118.551400228519,118.414873769980,118.143194670435,118.045444645088,117.844349036082,117.511746986411,116.960712182633,116.322123392025,116.042517828822,115.844266361835,115.636166105440,115.393102511384,115.205696301207,114.910639521637,114.620141972894,114.520492695992,114.386284365809,114.200353337241,114.103538562582,114.143633524371,114.153774989689,114.116554377170,114.001639765668,113.557748485311,113.179750008439,113.069133792820,113.002671041423,113.010185229963,112.956883633249,112.915184585693,112.636388167519,112.527242971986,112.352141065017,112.264755875691,112.156759802604,111.986886007699,111.897160939943,111.812126406705,NaN];
    Yangtzelat=[30.3354829609347,30.3162378996852,30.2994363172800,30.3679251066827,30.5377024362833,30.7308299991966,30.8547411902248,30.9708267262762,30.9965484287298,30.9932398372326,30.9985315308513,30.9774340139899,30.9373434730190,30.9201881974127,30.7637404293904,30.3548047491705,29.9716307614179,29.8528571509581,29.7546809498848,29.7014574893788,29.6020058192944,29.3448531876994,29.0323887211137,28.9573566038784,28.7406200729983,28.7549421002832,28.8771505350936,28.8215891085751,28.5968947947536,28.6117711004343,28.6443849522760,28.6326996761558,28.4886648209192,28.2433501304205,27.9277561320013,27.6644129695344,27.4392701995127,27.3451042286746,27.0923694742233,26.7061799896363,26.4278063747580,26.3208866772620,26.2090329010010,26.2037959809258,26.3505151466786,26.3150725686764,26.0002671902567,25.9676933423725,26.1065066213752,26.3394308679985,26.4706005717387,26.5650265572968,26.5665238417525,26.5387055197895,26.4525094270186,26.2339258539554,26.2193890779663,26.2626853657006,26.3831684122694,26.6635989074616,27.0460482426394,27.3092160395689,27.6481435779346,27.8090481708519,27.8318795062661,27.7529054988919,27.2359392948189,27.0305677868185,26.8601512381793,27.2414537303841,27.5392665966446,27.9150634742437,28.1747202542787,28.4439302451752,28.6489391336526,29.0591738977128,29.7127815188842,30.4393889221217,31.1578700056566,31.2657844146158,31.3778876241458,31.4946720073974,32.0389897640086,32.3661286583779,32.6919003113350,32.8578610401901,33.2375732510136,33.4107779233207,33.9549229930287,34.1573671823583,34.3155556534077,34.4862497526074,34.6127316796277,34.7355063819930,34.7439617007357,34.6347190985812,34.3187792912637,34.2353915429522,34.1612732547774,34.1342588281008,34.2788452999238,34.2377128646488,34.1587756823123,34.1955221850123,34.2813494294680,34.2787035330242,34.2577633907659,34.2185318369584,34.2180241573277,NaN,31.5788930047085,31.6575490994222,31.7250481181793,31.9680459270501,32.0887950295242,32.1198678392547,32.0924283667840,31.9873452956444,31.9984602282878,32.2732076066296,32.2909798612861,32.2221069566712,32.2085066667753,32.0998645498680,31.9553230684040,31.5140483922883,31.3026591888784,31.0860374497524,30.8452188114545,30.4717607488557,29.9255920520252,29.7550730847683,29.7509565428970,29.7855655953100,29.8720884312854,29.9965690719145,30.3283041654826,30.6020806249717,30.6547431330578,30.6691861831226,30.5039712752600,30.3634741572904,30.1699036543417,30.0410426110999,29.9449384371876,29.8561807420781,29.6682968936427,29.4658752583944,29.4448517220644,29.4904318012738,29.7390573777251,29.8040381455931,29.8109609087411,29.7937632161256,29.8222166012548,30.0510078908893,30.2111517118257,30.3089610598378,30.3495752696255,30.3450035841119,30.3354829609347,NaN];
    m_plot(Yangtzelon,Yangtzelat,'color',rgb('cyan'),'linewidth',1);

lonrange = near1(lonera,110):near1(lonera,140); latrange = near1(latera,35):near1(latera,25);
    kuang=zeros(size(Pr));
    kuang(lonrange,latrange)=100;   
[cs,h]=m_contour(LON',LAT',kuang,[100:100:200],'linestyle','-','linewidth',1.2,'color','k');   hold on; 

legend ([h1 h2],'ERA5','GPCP','color','none','edgecolor','none','fontsize',fontsi);



%% compare simulated and obs relative contribution of LSP
clc;clear all;
clear t0;clear t;
var = 'PRECT';
period = [1981:2010];
dir=['/.../',var,'/proc/'];
for num=1:100;num
    file=[dir,var,'_EastAsia_90E180E_0N60N_19002100_',num2str(num),'.nc']; 
    t = squeeze(ncread(file,var));
    t = reshape(t(:,:,1:130*12),[73,64,12,130]);
    t = squeeze(mean(t(:,:,6:7,:),3));
    t = t(:,:,period-1900+1,:); 
    Pr0_t(:,:,:,num)=t;
end;
var = 'PRECL';
dir=['/.../',var,'/proc/'];
for num=1:100;num
    file=[dir,var,'_EastAsia_90E180E_0N60N_19002100_',num2str(num),'.nc']; 
    t = squeeze(ncread(file,var));
    t = reshape(t(:,:,1:130*12),[73,64,12,130]);
    t = squeeze(mean(t(:,:,6:7,:),3));
    t = t(:,:,period-1900+1,:); 
    Pr0_l(:,:,:,num)=t;
end;

close all;figure(1);
set(gcf, 'position', [100 200 500 320]); 
handaxes1 = axes('Position', [0.15 0.1 0.79 0.9]);
set(gcf,'color','w');
hold on;

    imread('.../colormap.png');  color=ans(10,:,:); colorfinal=(squeeze(color));colorfinal=colorfinal(20:50:end,:);colorfinal=cat(1,ones(1,3)*255,colorfinal(1:end-1,:));colormap(double(colorfinal)/255)   ;
    latcesm=ncread(file,'lat');loncesm=ncread(file,'lon');[LON,LAT]=meshgrid(loncesm,latcesm);
    Pr_t=mean(mean(Pr0_t,3),4)*1000*60*60*24; % m/s to mm/day
    Pr_l=mean(mean(Pr0_l,3),4)*1000*60*60*24; % m/s to mm/day
    con=Pr_l./Pr_t *100;
    m_contourf(LON',LAT',con,[0:5:100],'linestyle','none','lineco',rgb('pink'),'linewi',1.2); hold on; 
    cx=[30 100];caxis(cx);
    c=colorbar('horizontal','position',[0.6 0.36 0.3 0.025]); 
    c.Label.VerticalAlignment='bottom'; c.XTick=[20:20:100]; c. TickLength=0.01; c.FontSize =fontsi;

m_grid('box','on','linewidth',0.5,'linest','none','color',[1 1 1]*0,'tickdir','in','xtick',[-0:10:360],'ytick',[-80:5:90],'fontsize',fontsi);%'YTickLabel'
m_coast('linewidth',0.5,'color',[1 1 1]* 0 );  

   rivers = shaperead('worldrivers', 'UseGeoCoords', true);  
    Yangtzelon=[111.812126406705,111.617491409822,111.506201483461,111.377369777222,111.324577964913,111.304329409756,111.127690456420,110.579842600508,110.090971083005,109.859832209738,109.463170581409,109.126008277736,108.774428204806,108.622755527179,108.412454704962,108.109784975061,107.767845629656,107.605584604302,107.277336794183,106.866828394550,106.659409896486,106.414168831486,105.979101833691,105.879254886543,105.335096266790,105.129180209058,104.867723652864,104.706928692368,104.364592534880,104.091212606074,103.966204641485,103.849767714248,103.691780436767,103.555561827381,103.519273484281,103.275319667000,102.999059476395,102.926643930504,102.936081263710,103.036200292578,103.026305037876,102.959646199442,102.776685596601,102.676813014934,102.519277948189,102.373186994147,102.053298961830,101.898068985969,101.860762451450,101.919829634165,101.882272692055,101.751128720409,101.691160834859,101.501818525004,101.303255278576,100.931333808346,100.731049812833,100.562232817490,100.430413795709,100.412743659151,100.456270683369,100.515513586111,100.575339813117,100.486560665925,100.372539238615,100.281581958429,100.072996645657,100.058825731678,99.8426770937218,99.6975946675545,99.5112103566063,99.4160753092215,99.3942455093605,99.2780537292445,99.1468132666509,99.0462572273536,99.0052196089284,98.8874723334740,98.6915840424053,98.7522978847366,98.8734135680564,98.8718854272409,98.5442015300226,98.2994734004280,97.7481050517092,97.5708435465878,97.2822873630522,97.1124452710207,96.3147755285777,95.9688609087148,95.7349684681276,95.2926674087438,94.9086266837214,94.7573923372252,94.6211734395713,94.3047857799314,93.8281849372111,93.4544006457852,92.9682758665929,92.7825410413103,92.5330173320002,92.1815993074306,91.8845270925069,91.7002271597796,91.2827901881376,90.9613301232510,90.7397351892746,90.6181366693018,90.5568859681901,NaN,121.383878533308,121.325457092976,121.144532209900,120.842735400716,120.698510249433,120.575516191191,120.358951867320,120.062712534585,119.852697254398,119.709005180783,119.527915100958,118.952742017552,118.778554856493,118.551400228519,118.414873769980,118.143194670435,118.045444645088,117.844349036082,117.511746986411,116.960712182633,116.322123392025,116.042517828822,115.844266361835,115.636166105440,115.393102511384,115.205696301207,114.910639521637,114.620141972894,114.520492695992,114.386284365809,114.200353337241,114.103538562582,114.143633524371,114.153774989689,114.116554377170,114.001639765668,113.557748485311,113.179750008439,113.069133792820,113.002671041423,113.010185229963,112.956883633249,112.915184585693,112.636388167519,112.527242971986,112.352141065017,112.264755875691,112.156759802604,111.986886007699,111.897160939943,111.812126406705,NaN];
    Yangtzelat=[30.3354829609347,30.3162378996852,30.2994363172800,30.3679251066827,30.5377024362833,30.7308299991966,30.8547411902248,30.9708267262762,30.9965484287298,30.9932398372326,30.9985315308513,30.9774340139899,30.9373434730190,30.9201881974127,30.7637404293904,30.3548047491705,29.9716307614179,29.8528571509581,29.7546809498848,29.7014574893788,29.6020058192944,29.3448531876994,29.0323887211137,28.9573566038784,28.7406200729983,28.7549421002832,28.8771505350936,28.8215891085751,28.5968947947536,28.6117711004343,28.6443849522760,28.6326996761558,28.4886648209192,28.2433501304205,27.9277561320013,27.6644129695344,27.4392701995127,27.3451042286746,27.0923694742233,26.7061799896363,26.4278063747580,26.3208866772620,26.2090329010010,26.2037959809258,26.3505151466786,26.3150725686764,26.0002671902567,25.9676933423725,26.1065066213752,26.3394308679985,26.4706005717387,26.5650265572968,26.5665238417525,26.5387055197895,26.4525094270186,26.2339258539554,26.2193890779663,26.2626853657006,26.3831684122694,26.6635989074616,27.0460482426394,27.3092160395689,27.6481435779346,27.8090481708519,27.8318795062661,27.7529054988919,27.2359392948189,27.0305677868185,26.8601512381793,27.2414537303841,27.5392665966446,27.9150634742437,28.1747202542787,28.4439302451752,28.6489391336526,29.0591738977128,29.7127815188842,30.4393889221217,31.1578700056566,31.2657844146158,31.3778876241458,31.4946720073974,32.0389897640086,32.3661286583779,32.6919003113350,32.8578610401901,33.2375732510136,33.4107779233207,33.9549229930287,34.1573671823583,34.3155556534077,34.4862497526074,34.6127316796277,34.7355063819930,34.7439617007357,34.6347190985812,34.3187792912637,34.2353915429522,34.1612732547774,34.1342588281008,34.2788452999238,34.2377128646488,34.1587756823123,34.1955221850123,34.2813494294680,34.2787035330242,34.2577633907659,34.2185318369584,34.2180241573277,NaN,31.5788930047085,31.6575490994222,31.7250481181793,31.9680459270501,32.0887950295242,32.1198678392547,32.0924283667840,31.9873452956444,31.9984602282878,32.2732076066296,32.2909798612861,32.2221069566712,32.2085066667753,32.0998645498680,31.9553230684040,31.5140483922883,31.3026591888784,31.0860374497524,30.8452188114545,30.4717607488557,29.9255920520252,29.7550730847683,29.7509565428970,29.7855655953100,29.8720884312854,29.9965690719145,30.3283041654826,30.6020806249717,30.6547431330578,30.6691861831226,30.5039712752600,30.3634741572904,30.1699036543417,30.0410426110999,29.9449384371876,29.8561807420781,29.6682968936427,29.4658752583944,29.4448517220644,29.4904318012738,29.7390573777251,29.8040381455931,29.8109609087411,29.7937632161256,29.8222166012548,30.0510078908893,30.2111517118257,30.3089610598378,30.3495752696255,30.3450035841119,30.3354829609347,NaN];
    m_plot(Yangtzelon,Yangtzelat,'color',rgb('cyan'),'linewidth',1);

% compare with ERA5 data
file='/.../data-ERA5/precipitation/monthly/pr_era5_197901-202012.nc';pt=ncread(file,'tp');
file='/.../data-ERA5/precipitation/monthly/prl_era5_197901-202012.nc';pl=ncread(file,'lsp');
    lonera=ncread(file,'longitude');latera=ncread(file,'latitude');[LON,LAT]=meshgrid(lonera,latera);
    pt=reshape(pt,[360 181 12 504/12]);
    pt=squeeze(mean(pt(:,:,6:7,:),3));
    pt=nanmean(pt(:,:,[1981:2010]-1979+1),3); %% mm/day
    pl=reshape(pl,[360 181 12 504/12]);
    pl=squeeze(mean(pl(:,:,6:7,:),3));
    pl=nanmean(pl(:,:,[1981:2010]-1979+1),3); %% mm/day
    [C,h]=m_contour(LON',LAT',pl./pt *100,[40:10:70],'linestyle','-','lineco',rgb('bright pink'),'linewi',1); hold on; 
    clabel(C,h,[40:10:70],'color',rgb('bright pink'),'fontsi',fontsi,'margin',10)

lonrange = near1(lonera,110):near1(lonera,140); latrange = near1(latera,35):near1(latera,25);
    kuang=zeros(size(pt));
    kuang(lonrange,latrange)=100;
[cs,hs]=m_contour(LON',LAT',kuang,[100:100:200],'linestyle','-','linewidth',1.2,'color','k');   hold on; 

legend ([h],'ERA5','color','none','edgecolor','none','fontsize',fontsi);
        


%% compare similated and obs seasonal march of rain belt
clc;clear all;

file='/Volumes/CESM2D_Pr/PRECL/proc/PRECL_EastAsia_June_100_combine_19502014.nc';
loncesmpr = ncread(file,'lon');  latcesmpr = ncread(file,'lat');
lonrange = near1(loncesmpr,110):near1(loncesmpr,140); 
    var = 'PRECC'; 
    pr=zeros(64,31*65,100); % July
for i=1:100,
    dir = ['/.../CESM2D_Pr/',var,'/proc/'];
    file= [dir,var,'_EastAsia_July_',num2str(i),'_combine_19502014.nc'];
    temp=ncread(file,var);
    temp=squeeze(nanmean(temp(lonrange,:,:),1));
    pr(:,1:size(temp,2),i) = temp;
end;
pr = reshape(pr,[64,31,65,100]);
pr7=pr;
pr7=nanmean(pr7,4);
    pr=zeros(64,30*65,100); % June
for i=1:100,
    dir = ['/.../CESM2D_Pr/',var,'/proc/'];
    file= [dir,var,'_EastAsia_June_',num2str(i),'_combine_19502014.nc'];
    temp=ncread(file,var);
    temp=squeeze(nanmean(temp(lonrange,:,:),1));
    pr(:,1:size(temp,2),i) = temp;
end;
pr = reshape(pr,[64,30,65,100]);
pr6=pr;
pr6=nanmean(pr6,4);
    prC = cat(2,pr6,pr7); 

    var = 'PRECL'; 
    pr=zeros(64,31*65,100); % July
for i=1:100,
    dir = ['/Volumes/CESM2D_Pr/',var,'/proc/'];
    file= [dir,var,'_EastAsia_July_',num2str(i),'_combine_19502014.nc'];
    temp=ncread(file,var);
    temp=squeeze(nanmean(temp(lonrange,:,:),1));
    pr(:,1:size(temp,2),i) = temp;
end;
pr = reshape(pr,[64,31,65,100]);
pr7=pr;
pr7=nanmean(pr7,4);
    pr=zeros(64,30*65,100); % June
for i=1:100,
    dir = ['/.../CESM2D_Pr/',var,'/proc/'];
    file= [dir,var,'_EastAsia_June_',num2str(i),'_combine_19502014.nc'];
    temp=ncread(file,var);
    temp=squeeze(nanmean(temp(lonrange,:,:),1));
    pr(:,1:size(temp,2),i) = temp;
end;
pr = reshape(pr,[64,30,65,100]);
pr6=pr;
pr6=nanmean(pr6,4);
    prL = cat(2,pr6,pr7); 

    pr = prC+prL; clear pr6;clear pr7;
    
% ERA5    
load('/.../data-ERA5/precipitation/AccumulatedDailyPr_19792020_360x91x365x42.mat','Pr','lat','lon');Pr=Pr*1000;
lonrange = near1(lon,110):near1(lon,140);
june=31+28+31+30+31;Prera=squeeze(mean(mean(Pr(lonrange,:,june+1:june+61,[1981:2010]-1979+1),1),4));

close all;figure(1); 
set(gcf, 'position', [100 200 480 300]);
handaxes1 = axes('Position', [0.12 0.3 0.82 0.55]);
set(gcf,'color','w');
hold on;
fontsi = 12;
    imread('.../colormap.png');  color=ans(10,:,:);  colorfinal=(squeeze(color));colorfinal=colorfinal(200:200:end,:);colorfinal=cat(1,ones(1,3)*255,colorfinal(5:8,:),rgb('dark green')*255);colormap(double(colorfinal)/255)   ;
    Prcesm=nanmean(pr(:,:,[1981:2010]-1950+1),3) .*1000 .*60*60*24;%unit
    [LON,LAT]=meshgrid(latcesmpr,1:61);
    contourf(LAT',LON',Prcesm,[6:1:20],'linestyle','none','lineco',rgb('pink')); hold on; 
    cx=[5 11];caxis(cx); 
    c=colorbar('horizontal','position',[0.6 0.36 0.3 0.025]); 
    c.Label.VerticalAlignment='bottom'; c.XTick=[5:1:20]; c. TickLength=0.01; c.FontSize =fontsi;

    [LON,LAT]=meshgrid(lat,1:61);
    Pr = Prera;
    contour(LAT',LON',Pr,[6:2:20],'linestyle','-','lineco',rgb('bright pink'),'linewi',1.2); hold on; 

    ax = gca;       
        ax.FontSize = 12;
        ax.YLim = [23 47];ax.YTick=[15:5:70];
        ax.XLim=([0.9,30+31]);ax.XTick=[1:10:31+30];
        ax.XGrid='off';        ax.YMinorTick='off';  ax.XMinorTick='off';
        ax.FontSize=fontsi;
        ax.FontName='Helvetica';
        set(gca,'tickdir','in');
        ax.YTickLabel = {'15^oN','20^oN','25^oN','30^oN','35^oN','40^oN','45^oN',}
        ax.XTickLabel = {'Jun 1','Jun 11','Jun 21','Jul 1','Jul 11','Jul 21','Jul 31'}
        ax.Box='on';ax.LineWidth=0.5;ax.TickLength=[0.02 0.02];

 



%% compare simulated and obs Meiyu-Baiu rainfall time series 
clc;clear all;
period    = [1950:2014];
periodave = [1981:2010];
var = 'PRECT';
dir=['/.../',var,'/proc/'];
for num=1:100;num
    file=[dir,var,'_EastAsia_90E180E_0N60N_19002100_',num2str(num),'.nc']; 
    t = squeeze(ncread(file,var));
    t = reshape(t(:,:,1:130*12),[73,64,12,130]);
    t = t(:,:,6:7,:);
    t = t - nanmean(t(:,:,:,periodave-1900+1),4); 
    t = t(:,:,:,period-1900+1); 
    Pr0(:,:,:,:,num)=t;
end;
latcesm=ncread(file,'lat');loncesm=ncread(file,'lon');
lonrange=near1(loncesm,110):near1(loncesm,140);latrange=near1(latcesm,25):near1(latcesm,35);
[Lonera,Latera] = meshgrid(loncesm(lonrange),latcesm(latrange)); 
A_era = cdtarea(Latera,Lonera);
p=reshape(Pr0,[73,64,2,65*100]);
for i=1:2; for j=1:size(p,4);
    temp(i,j)=wmean(p(lonrange,latrange,i,j)',A_era,'all','omitnan');
end;end;
Prcesm=reshape(temp,[2,size(temp,2)/100,100])*1000*60*60*24; % m/s to mm/day

% ERA5
file='/.../data-ERA5/precipitation/monthly/pr_era5_195001-197812.nc';p1=ncread(file,'tp');
file='/.../data-ERA5/precipitation/monthly/pr_era5_197901-202012.nc';p2=ncread(file,'tp');
    p=cat(3,p1,p2);
    p=reshape(p,[360 181 12 852/12]);
    p=p(:,:,6:7,:);
    lonera=ncread(file,'longitude');latera=ncread(file,'latitude');
    lonrange=near1(lonera,110):near1(lonera,140);latrange=near1(latera,35):near1(latera,25);
    [Lonera,Latera] = meshgrid(lonera(lonrange),latera(latrange)); 
    A_era = cdtarea(Latera,Lonera);
    clear temp;for i=1:2; for j=1:size(p,4);
        temp(i,j)=wmean(p(lonrange,latrange,i,j)',A_era,'all','omitnan');
    end;end;
    Pr=temp*1000; %% mm/day
    Prera=Pr-mean(Pr(:,[periodave]-1950+1),2);

% GPCP 
file ='/.../GPCP_pr/precip.mon.mean.nc'; p=ncread(file,'precip');
    p=reshape(p(:,:,1:12*43),[144 72 12 43]);
    p=p(:,:,6:7,:);
    longpcp=ncread(file,'lon');latgpcp=ncread(file,'lat');
    lonrange=near1(longpcp,110):near1(longpcp,140);latrange=near1(latgpcp,25):near1(latgpcp,35);
    [Lonera,Latera] = meshgrid(longpcp(lonrange),latgpcp(latrange)); A_era = cdtarea(Latera,Lonera);%  Arctic
    clear temp;for i=1:2; for j=1:size(p,4);
        temp(i,j)=wmean(p(lonrange,latrange,i,j)',A_era,'all','omitnan');
    end;end;
    Prgpcp=temp-mean(temp(:,[periodave]-1979+1),2);

close all;figure(1);
set(gcf, 'position', [1 200 480 350]);
handaxes1 = axes('Position', [0.15 0.3 0.79 0.51]);
set(gcf,'color','w');
hold on;

nc1=rgb('black'); nc2=rgb('green'); nc=[nc1;nc2]; colororder(nc)
mon = 6; mm=30;
% mon = 7; mm=31;
for i=1:100;
    h0(1)=plot(period,mm*Prcesm(mon-5,:,i),'-','color',rgb('light grey'),'linewi',0.5);
end;
    h0(2)=plot(period,mm*mean(Prcesm(mon-5,:,:),3),'--','color',rgb('black'),'linewi',1);
ax=gca;fontsi=12;
        ax.YLim=([-180 180]);ax.YTick=[-300:60:200];
        ax.XLim=([1950-1 2015]);ax.XTick=[1950:10:2100];
        ax.XGrid='off';        ax.YMinorTick='off';  ax.XMinorTick='on';
        ax.FontSize=fontsi;
        ax.FontName='Helvetica';
        ax.Box='on';ax.LineWidth=0.5;ax.TickLength=[0.01 0.01];
        set(gca,'tickdir','in');
        yl=ylabel('Accumulated Pr anomaly (mm)'); yl.FontSize=fontsi;

% ERA5
period = [1950:2020];
    h1=plot(period,mm*Prera(mon-5,:),'-','color',rgb('bright pink'),'linewi',1.3);
    var_era(1)=std(mm*Prera(mon-5,:));
% GPCP
    h2=plot([1979:2021],mm*Prgpcp(mon-5,:),'-','color',rgb('golden'),'linewi',1.5);
    var_gpcp(1)=std(mm*Prgpcp(mon-5,:));

ll=legend ([h0([1 2]),h1 h2],'Individual runs','Ensemble mean','ERA5','GPCP','edgecolor','k');ll.Orientation='horizontal';ll.Color ='none';ll.Location = 'north';



%% compare simulated and obs monthly Meiyu-Baiu rainfall variance >10yr <10yr
close all;figure(1); 
set(gcf, 'position', [1 200 280 350]);
handaxes1 = axes('Position', [0.15 0.3 0.79 0.51]);
set(gcf,'color','w');
hold on;

data1=filt1('hp',Prera(mon-5,:),'Tc',[10]);
    var_era(2)=std(mm*data1);
    c01=corr(Prera(mon-5,:)',data1').^2;
data2=filt1('lp',Prera(mon-5,:),'Tc',[11]);
    c02=corr(Prera(mon-5,:)',data2').^2;
    var_era(3)=std(mm*data2);
% c02=corr(data1',data2').^2

for i=1:100
data=filt1('hp',Prcesm(mon-5,:,i),'Tc',[10]);
    var_cesm(2,i)=std(mm*data);
    c1(i)=corr(Prcesm(mon-5,:,i)',data').^2;
data=filt1('lp',Prcesm(mon-5,:,i),'Tc',[11]);
    var_cesm(3,i)=std(mm*data);
    c2(i)=corr(Prcesm(mon-5,:,i)',data').^2;
end;c1=mean(c1);c2=mean(c2);

for i=2:3
    h1=bar(i-0.15,[var_era(i)],0.3,'edgecolor','none','facecolor',rgb('bright pink'));
    if i==2 &&mon==6; text(i-0.25,[var_era(i)]+3,'82%','color',rgb('bright pink'),'fontsi',fontsi);end;
    if i==2 &&mon==7 ; text(i-0.25,[var_era(i)]+3,'76%','color',rgb('bright pink'),'fontsi',fontsi);end;
end;
for i=2:3
    h2=bar(i+0.15,[mean(var_cesm(i,:),2)],0.3,'edgecolor','none','facecolor',rgb('grey'));
    plot(i+0.15*[1 1],[min(var_cesm(i,:)),max(var_cesm(i,:))],'color',rgb('grey'),'linewi',2);
    if i==2 &&mon==6; text(i+0.065,max(var_cesm(i,:))+3,'83%','color',rgb('grey'),'fontsi',fontsi);end;
    if i==2 &&mon==7; text(i+0.065,max(var_cesm(i,:))+3,'81%','color',rgb('grey'),'fontsi',fontsi+1);end;
end;

ax=gca;fontsi=12;alpha 0.6;
        ax.YLim=([-0 56]);ax.YTick=[0:10:50];
        ax.XLim=([1.5,3.5]);ax.XTick=[2:1:3];
        ax.XGrid='off';        ax.YMinorTick='on';  ax.XMinorTick='off';
        ax.FontSize=fontsi;
        ax.FontName='Helvetica';
        ax.Box='on';ax.LineWidth=0.5;ax.TickLength=[0.01 0.01];
        ax.XTickLabel={'<10yr','>=10yr'};
        set(gca,'tickdir','in');
        yl=ylabel('SD of accumulated Pr (mm)'); yl.FontSize=fontsi;

ll=legend ([h1 h2],'ERA5','CESM2LE','edgecolor','k');ll.Orientation='horizontal';ll.Color ='none';ll.Location = 'northeast';










